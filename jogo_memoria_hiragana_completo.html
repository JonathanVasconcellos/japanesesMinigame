<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Jogo da Memória - Hiragana e Romanji</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Japanese&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Sans Japanese', Arial, sans-serif;
      text-align: center;
      margin: 20px;
      background: linear-gradient(to bottom, #fff, #f8e1e1);
      color: #333;
      transition: all 0.3s ease;
    }
    body.dark-mode {
      background: linear-gradient(to bottom, #1a1a1a, #2a2a2a);
      color: #e0e0e0;
    }
    .menu {
      margin-bottom: 20px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    body.dark-mode .menu {
      background: #333;
      box-shadow: 0 2px 5px rgba(255, 255, 255, 0.1);
    }
    .checkbox-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 10px 0;
      width: 100%;
    }
    .menu-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
      width: 100%;
    }
    .game-container {
      display: none;
      flex-direction: row;
      justify-content: center;
      gap: 20px;
      margin: 0 auto;
      max-width: 800px;
    }
    .board {
      display: grid;
      gap: 8px;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    body.dark-mode .board {
      background: #333;
      box-shadow: 0 2px 5px rgba(255, 255, 255, 0.1);
    }
    .training-container {
      display: none;
      flex-direction: column;
      align-items: center;
      margin: 0 auto;
      max-width: 800px;
    }
    .game-info, .training-info {
      background: #fff;
      padding: 15px;
      border: 2px solid #d32f2f;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      min-width: 200px;
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    body.dark-mode .game-info, body.dark-mode .training-info {
      background: #333;
      border: 2px solid #ff5555;
      box-shadow: 0 2px 5px rgba(255, 255, 255, 0.1);
    }
    .game-info h3, .training-info h3 {
      margin: 0;
      font-size: 1.1em;
      color: #d32f2f;
    }
    body.dark-mode .game-info h3, body.dark-mode .training-info h3 {
      color: #ff5555;
    }
    .game-info p {
      margin: 2px 0;
      min-width: 150px;
      white-space: nowrap;
      font-weight: bold;
    }
    .game-info .info-data {
      font-weight: normal;
      margin: 0;
    }
    .training-info p {
      margin: 2px 0;
      white-space: nowrap;
    }
    .training-info .info-data {
      display: flex;
      justify-content: center;
      gap: 20px;
      font-weight: normal;
      margin: 0;
    }
    .card {
      width: 80px;
      height: 80px;
      background: #f5f5f5;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
      cursor: pointer;
      user-select: none;
      border: 2px solid #d32f2f;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      color: #333;
    }
    body.dark-mode .card {
      background: #4a4a4a;
      border: 2px solid #ff5555;
      color: #fff;
    }
    .card.flipped {
      background: #fff;
      border: 2px solid #333;
      color: #333;
    }
    body.dark-mode .card.flipped {
      background: #e0e0e0;
      border: 2px solid #fff;
      color: #333;
    }
    .card.matched {
      background: #d4edda;
      cursor: default;
      color: #333;
    }
    body.dark-mode .card.matched {
      background: #4a704a;
      color: #fff;
    }
    button {
      padding: 10px 20px;
      font-size: 1em;
      margin: 5px;
      cursor: pointer;
      background: #d32f2f;
      color: #fff;
      border: none;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    body.dark-mode button {
      background: #ff5555;
      box-shadow: 0 2px 5px rgba(255, 255, 255, 0.2);
    }
    button:hover {
      background: #b71c1c;
    }
    body.dark-mode button:hover {
      background: #cc3333;
    }
    select {
      padding: 5px;
      font-size: 1em;
      margin: 10px;
      border: 2px solid #d32f2f;
      border-radius: 5px;
    }
    body.dark-mode select {
      border: 2px solid #ff5555;
      background: #333;
      color: #e0e0e0;
    }
    .error {
      color: #d32f2f;
      font-size: 0.9em;
      margin: 5px 0;
    }
    body.dark-mode .error {
      color: #ff5555;
    }
    .modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      padding: 20px;
      border: 2px solid #d32f2f;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      text-align: center;
    }
    body.dark-mode .modal {
      background: #333;
      border: 2px solid #ff5555;
      color: #e0e0e0;
    }
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
    }
    .game-controls {
      margin: 10px 0;
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .training-controls {
      margin: 10px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    .training-action-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .training-nav-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    #trainingChar {
      font-size: 4em;
      margin: 20px 0;
    }
    #inputRomanji {
      font-size: 1.2em;
      padding: 5px;
      width: 200px;
      margin-bottom: 10px;
    }
    .feedback {
      margin: 10px 0;
      font-size: 1.1em;
    }
    .error-list {
      margin: 10px 0;
      padding: 10px;
      background: #f9e1e1;
      border: 1px solid #d32f2f;
      border-radius: 5px;
      max-width: 400px;
      text-align: left;
    }
    body.dark-mode .error-list {
      background: #4a2a2a;
      border: 1px solid #ff5555;
    }
    .error-list h4 {
      margin: 0 0 10px 0;
      font-size: 1.1em;
      color: #d32f2f;
    }
    body.dark-mode .error-list h4 {
      color: #ff5555;
    }
    .error-list p {
      margin: 5px 0;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <h1>Jogo da Memória - Hiragana e Romanji</h1>
  <div class="menu">
    <div class="checkbox-container">
      <label><input type="checkbox" class="setCheck" value="vowels" checked> Vogais (あ, い, う, え, お)</label>
      <label><input type="checkbox" class="setCheck" value="kSeries"> Série K (か, き, く, け, こ)</label>
      <label><input type="checkbox" class="setCheck" value="sSeries"> Série S (さ, し, す, せ, そ)</label>
      <label><input type="checkbox" class="setCheck" value="tSeries"> Série T (た, ち, つ, て, と)</label>
      <label><input type="checkbox" class="setCheck" value="nSeries"> Série N (な, に, ぬ, ね, の)</label>
      <label><input type="checkbox" class="setCheck" value="hSeries"> Série H (は, ひ, ふ, へ, ほ)</label>
      <label><input type="checkbox" class="setCheck" value="mSeries"> Série M (ま, み, む, め, も)</label>
      <label><input type="checkbox" class="setCheck" value="ySeries"> Série Y (や, ゆ, よ)</label>
      <label><input type="checkbox" class="setCheck" value="rSeries"> Série R (ら, り, る, れ, ろ)</label>
      <label><input type="checkbox" class="setCheck" value="wSeries"> Série W (わ, を)</label>
      <label><input type="checkbox" class="setCheck" value="nFinal"> N Final (ん)</label>
    </div>
    <div>
      <label for="cardCount">Número de cartas:</label>
      <select id="cardCount">
        <option value="8">8</option>
        <option value="16">16</option>
        <option value="20">20</option>
        <option value="30">30</option>
      </select>
    </div>
    <div id="errorMessage" class="error"></div>
    <div class="menu-buttons">
      <button onclick="startGame()">Iniciar Jogo</button>
      <button onclick="startTraining()">Treino</button>
      <button id="musicToggle" onclick="toggleMusic()">Pausar Música</button>
      <button id="themeToggle" onclick="toggleTheme()">Modo Escuro</button>
    </div>
  </div>
  <div class="game-controls" style="display: none;">
    <button onclick="returnToMenu()">Voltar ao Menu</button>
    <button id="musicToggle" onclick="toggleMusic()">Pausar Música</button>
    <button id="themeToggle" onclick="toggleTheme()">Modo Escuro</button>
  </div>
  <div class="game-container" id="gameContainer">
    <div class="board" id="gameBoard"></div>
    <div class="game-info" id="gameInfo">
      <h3>Informações do Jogo</h3>
      <p>Modo:</p>
      <p class="info-data" id="modeInfo">Padrão</p>
      <p>Tempo:</p>
      <p class="info-data" id="timeElapsed">0 min 0 seg</p>
      <p>Tentativas:</p>
      <p class="info-data" id="attempts">0</p>
      <p>Acertos:</p>
      <p class="info-data" id="matches">0</p>
    </div>
  </div>
  <div class="training-container" id="trainingContainer">
    <div class="training-info" id="trainingInfo">
      <h3>Informações do Treino</h3>
      <div class="info-data">
        <span>Acertos: <span id="trainingHits">0</span></span>
        <span>Erros: <span id="trainingErrors">0</span></span>
        <span>Total: <span id="trainingTotal">0</span></span>
        <span>Restantes: <span id="trainingRemaining">30</span></span>
      </div>
    </div>
    <div id="trainingChar"></div>
    <input type="text" id="inputRomanji" placeholder="Digite o Romanji">
    <div class="training-controls">
      <div class="training-action-buttons">
        <button onclick="checkAnswer()">Confirmar</button>
        <button id="restartTraining" style="display: none;" onclick="restartTraining()">Reiniciar Treino</button>
      </div>
      <div class="training-nav-buttons">
        <button onclick="returnToMenu()">Voltar ao Menu</button>
        <button id="musicToggle" onclick="toggleMusic()">Pausar Música</button>
        <button id="themeToggle" onclick="toggleTheme()">Modo Claro</button>
      </div>
    </div>
    <div class="feedback" id="feedback"></div>
    <div class="error-list" id="errorList" style="display: none;"></div>
  </div>
  <div class="modal-overlay" id="modalOverlay"></div>
  <div class="modal" id="winModal">
    <h2>Parabéns!</h2>
    <p id="winMessage"></p>
    <button onclick="startGame()">Jogar Novamente</button>
  </div>

  <script>
    // Conjuntos de caracteres Hiragana e Romanji
    const sets = {
      vowels: [["あ", "a"], ["い", "i"], ["う", "u"], ["え", "e"], ["お", "o"]],
      kSeries: [["か", "ka"], ["き", "ki"], ["く", "ku"], ["け", "ke"], ["こ", "ko"]],
      sSeries: [["さ", "sa"], ["し", "shi"], ["す", "su"], ["せ", "se"], ["そ", "so"]],
      tSeries: [["た", "ta"], ["ち", "chi"], ["つ", "tsu"], ["て", "te"], ["と", "to"]],
      nSeries: [["な", "na"], ["に", "ni"], ["ぬ", "nu"], ["ね", "ne"], ["の", "no"]],
      hSeries: [["は", "ha"], ["ひ", "hi"], ["ふ", "fu"], ["へ", "he"], ["ほ", "ho"]],
      mSeries: [["ま", "ma"], ["み", "mi"], ["む", "mu"], ["め", "me"], ["も", "mo"]],
      ySeries: [["や", "ya"], ["ゆ", "yu"], ["よ", "yo"]],
      rSeries: [["ら", "ra"], ["り", "ri"], ["る", "ru"], ["れ", "re"], ["ろ", "ro"]],
      wSeries: [["わ", "wa"], ["を", "wo"]],
      nFinal: [["ん", "n"]]
    };

    // Mapeamento de valores para nomes de exibição
    const setNames = {
      vowels: "Vogais",
      kSeries: "Série K",
      sSeries: "Série S",
      tSeries: "Série T",
      nSeries: "Série N",
      hSeries: "Série H",
      mSeries: "Série M",
      ySeries: "Série Y",
      rSeries: "Série R",
      wSeries: "Série W",
      nFinal: "N Final"
    };

    // Carregar sons (todos em MP3)
    const flipSound = new Audio("Sound/flip.mp3");
    const matchSound = new Audio("Sound/match.mp3");
    const errorSound = new Audio("Sound/error.mp3");
    const winSound = new Audio("Sound/win.mp3");
    const clickSound = new Audio("Sound/click.mp3");
    const backgroundMusic = new Audio("Sound/background.mp3");
    backgroundMusic.loop = true;
    backgroundMusic.volume = 0.3;

    // Tocar música automaticamente ao carregar a página
    window.addEventListener('load', () => {
      backgroundMusic.play().catch(e => console.log("Erro ao iniciar música:", e));
    });
    document.addEventListener('click', () => {
      backgroundMusic.play().catch(e => console.log("Erro ao iniciar música:", e));
    }, { once: true });

    // Controle de música
    let isMusicPlaying = true;
    function toggleMusic() {
      clickSound.play();
      if (isMusicPlaying) {
        backgroundMusic.pause();
        document.querySelectorAll('#musicToggle').forEach(btn => btn.textContent = "Retomar Música");
        isMusicPlaying = false;
      } else {
        backgroundMusic.play().catch(e => console.log("Erro ao retomar música:", e));
        document.querySelectorAll('#musicToggle').forEach(btn => btn.textContent = "Pausar Música");
        isMusicPlaying = true;
      }
    }

    // Controle de tema
    function toggleTheme() {
      clickSound.play();
      document.body.classList.toggle('dark-mode');
      const isDarkMode = document.body.classList.contains('dark-mode');
      document.querySelectorAll('#themeToggle').forEach(btn => btn.textContent = isDarkMode ? "Modo Claro" : "Modo Escuro");
      localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
    }

    // Carregar tema salvo
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark-mode');
      document.querySelectorAll('#themeToggle').forEach(btn => btn.textContent = "Modo Claro");
    }

    let firstCard = null;
    let secondCard = null;
    let lockBoard = false;
    let matchesFound = 0;
    let totalPairs = 0;
    let startTime = 0;
    let attempts = 0;
    let timerInterval = null;

    // Estado do treino
    let trainingHits = 0;
    let trainingErrors = 0;
    let trainingTotal = 0;
    let currentTrainingChar = null;
    let lastTrainingChar = null;
    let errorStats = {};
    const trainingLimit = 30;
    let selectedChars = [];

    // Embaralhar array
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Atualizar o tempo decorrido
    function updateTime() {
      const elapsed = (Date.now() - startTime) / 1000;
      const minutes = Math.floor(elapsed / 60);
      const seconds = Math.round(elapsed % 60);
      document.getElementById("timeElapsed").textContent = `${minutes} min ${seconds} seg`;
    }

    // Iniciar jogo de memória
    function startGame() {
      clickSound.play();
      const checkboxes = document.querySelectorAll(".setCheck:checked");
      const cardCount = parseInt(document.getElementById("cardCount").value);
      const errorMessage = document.getElementById("errorMessage");
      const gameBoard = document.getElementById("gameBoard");
      const gameContainer = document.getElementById("gameContainer");
      const winModal = document.getElementById("winModal");
      const modalOverlay = document.getElementById("modalOverlay");
      const trainingContainer = document.getElementById("trainingContainer");

      // Esconder modais e containers
      winModal.style.display = "none";
      modalOverlay.style.display = "none";
      trainingContainer.style.display = "none";
      gameContainer.style.display = "none";

      // Verificar se pelo menos um conjunto está selecionado
      if (checkboxes.length === 0) {
        errorMessage.textContent = "Selecione pelo menos um conjunto!";
        return;
      }

      // Verificar se o número de cartas é válido
      if (cardCount % 2 !== 0 || ![8, 16, 20, 30].includes(cardCount)) {
        errorMessage.textContent = "O número de cartas deve ser 8, 16, 20 ou 30!";
        return;
      }

      // Construir lista de pares disponíveis e registrar séries selecionadas
      let availablePairs = [];
      const selectedSets = [];
      checkboxes.forEach(checkbox => {
        const set = sets[checkbox.value];
        availablePairs = availablePairs.concat(set);
        selectedSets.push(setNames[checkbox.value]);
      });

      // Exibir séries selecionadas
      document.getElementById("modeInfo").textContent = selectedSets.length > 0 ? selectedSets.join(", ") : "Nenhum";

      // Calcular pares necessários
      const neededPairs = cardCount / 2;

      // Selecionar pares, repetindo se necessário
      let selectedPairs = [];
      const shuffledAvailable = shuffle(availablePairs.slice());
      
      for (let i = 0; i < neededPairs; i++) {
        if (shuffledAvailable.length === 0) {
          shuffledAvailable.push(...shuffle(availablePairs.slice()));
        }
        selectedPairs.push(shuffledAvailable.shift());
      }

      errorMessage.textContent = "";
      const characters = selectedPairs.flat();
      const shuffled = shuffle(characters);

      // Ajustar grid para uma grade quadrada ou retangular completa
      let columns, rows;
      if (cardCount === 8) {
        columns = 2;
        rows = 4;
      } else if (cardCount === 16) {
        columns = 4;
        rows = 4;
      } else if (cardCount === 20) {
        columns = 4;
        rows = 5;
      } else if (cardCount === 30) {
        columns = 5;
        rows = 6;
      }
      gameBoard.style.gridTemplateColumns = `repeat(${columns}, 80px)`;
      gameBoard.style.gridTemplateRows = `repeat(${rows}, 80px)`;
      gameBoard.innerHTML = "";
      firstCard = null;
      secondCard = null;
      lockBoard = false;
      matchesFound = 0;
      attempts = 0;
      totalPairs = neededPairs;
      startTime = Date.now();

      // Resetar informações
      document.getElementById("timeElapsed").textContent = "0 min 0 seg";
      document.getElementById("attempts").textContent = "0";
      document.getElementById("matches").textContent = "0";

      // Iniciar temporizador
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(updateTime, 1000);

      // Criar cartas
      shuffled.forEach(char => {
        const card = document.createElement("div");
        card.classList.add("card");
        card.dataset.char = char;
        card.innerText = "?";
        card.addEventListener("click", () => flipCard(card));
        gameBoard.appendChild(card);
      });

      // Preencher a grade com cartas vazias se necessário
      const totalCells = columns * rows;
      while (gameBoard.children.length < totalCells) {
        const emptyCard = document.createElement("div");
        emptyCard.classList.add("card");
        emptyCard.style.background = "transparent";
        emptyCard.style.border = "none";
        emptyCard.style.cursor = "default";
        gameBoard.appendChild(emptyCard);
      }

      // Mostrar tabuleiro e controles, esconder menu
      document.querySelector('.menu').style.display = 'none';
      document.querySelector('.game-controls').style.display = 'flex';
      gameContainer.style.display = 'flex';
    }

    // Iniciar modo treino
    function startTraining() {
      clickSound.play();
      const checkboxes = document.querySelectorAll(".setCheck:checked");
      const errorMessage = document.getElementById("errorMessage");
      const gameContainer = document.getElementById("gameContainer");
      const trainingContainer = document.getElementById("trainingContainer");
      const winModal = document.getElementById("winModal");
      const modalOverlay = document.getElementById("modalOverlay");

      // Esconder modais e containers
      winModal.style.display = "none";
      modalOverlay.style.display = "none";
      gameContainer.style.display = "none";
      trainingContainer.style.display = "none";

      // Verificar se pelo menos um conjunto está selecionado
      if (checkboxes.length === 0) {
        errorMessage.textContent = "Selecione pelo menos um conjunto!";
        return;
      }

      // Resetar estado do treino
      trainingHits = 0;
      trainingErrors = 0;
      trainingTotal = 0;
      errorStats = {};
      lastTrainingChar = null;
      document.getElementById("trainingHits").textContent = "0";
      document.getElementById("trainingErrors").textContent = "0";
      document.getElementById("trainingTotal").textContent = "0";
      document.getElementById("trainingRemaining").textContent = trainingLimit;
      document.getElementById("inputRomanji").disabled = false;
      document.querySelector("button[onclick='checkAnswer()']").disabled = false;
      document.getElementById("restartTraining").style.display = "none";
      document.getElementById("errorList").style.display = "none";

      // Construir lista de caracteres disponíveis
      selectedChars = [];
      checkboxes.forEach(checkbox => {
        const set = sets[checkbox.value];
        selectedChars = selectedChars.concat(set.map(([hiragana]) => hiragana));
      });

      errorMessage.textContent = "";
      nextTrainingChar();

      // Mostrar container de treino e controles, esconder menu
      document.querySelector('.menu').style.display = 'none';
      document.querySelector('.training-controls').style.display = 'flex';
      trainingContainer.style.display = 'flex';
    }

    // Reiniciar treino
    function restartTraining() {
      clickSound.play();
      trainingHits = 0;
      trainingErrors = 0;
      trainingTotal = 0;
      errorStats = {};
      lastTrainingChar = null;
      document.getElementById("trainingHits").textContent = "0";
      document.getElementById("trainingErrors").textContent = "0";
      document.getElementById("trainingTotal").textContent = "0";
      document.getElementById("trainingRemaining").textContent = trainingLimit;
      document.getElementById("inputRomanji").disabled = false;
      document.querySelector("button[onclick='checkAnswer()']").disabled = false;
      document.getElementById("restartTraining").style.display = "none";
      document.getElementById("feedback").textContent = "";
      document.getElementById("errorList").style.display = "none";
      nextTrainingChar();
    }

    // Próximo caractere de treino
    function nextTrainingChar() {
      if (trainingTotal >= trainingLimit) {
        document.getElementById("feedback").textContent = "Treino concluído!";
        document.getElementById("inputRomanji").disabled = true;
        document.querySelector("button[onclick='checkAnswer()']").disabled = true;
        document.getElementById("restartTraining").style.display = "inline-block";

        // Mostrar lista de erros
        const errorList = document.getElementById("errorList");
        errorList.innerHTML = "";
        const errorKeys = Object.keys(errorStats);
        if (errorKeys.length > 0) {
          errorList.style.display = "block";
          errorList.innerHTML = "<h4>Caracteres Errados</h4>";
          errorKeys.forEach(char => {
            const correctRomanji = sets[Object.keys(sets).find(set => 
              sets[set].some(([hiragana]) => hiragana === char)
            )].find(([hiragana]) => hiragana === char)[1];
            errorStats[char].forEach(error => {
              const errorItem = document.createElement("p");
              errorItem.textContent = `${error.turn} - ${char} → ${error.input} (correto é ${correctRomanji})`;
              errorList.appendChild(errorItem);
            });
          });
        } else {
          errorList.style.display = "none";
        }
        return;
      }

      // Ajustar probabilidade com base em erros e evitar repetição
      let weightedChars = [];
      selectedChars.forEach(char => {
        if (char !== lastTrainingChar) {
          const errorCount = errorStats[char] ? errorStats[char].length : 0;
          const weight = Math.max(1, errorCount + 1); // Mais erros = maior peso
          for (let i = 0; i < weight; i++) {
            weightedChars.push(char);
          }
        }
      });

      // Se não houver opções válidas (todos são iguais ao último), reiniciar a lista
      if (weightedChars.length === 0) {
        selectedChars.forEach(char => {
          const errorCount = errorStats[char] ? errorStats[char].length : 0;
          const weight = Math.max(1, errorCount + 1);
          for (let i = 0; i < weight; i++) {
            weightedChars.push(char);
          }
        });
      }

      currentTrainingChar = shuffle(weightedChars)[0];
      lastTrainingChar = currentTrainingChar;
      document.getElementById("trainingChar").textContent = currentTrainingChar;
      document.getElementById("inputRomanji").value = "";
      document.getElementById("inputRomanji").focus();
      document.getElementById("feedback").textContent = "";
    }

    // Verificar resposta
    function checkAnswer() {
      clickSound.play();
      const input = document.getElementById("inputRomanji").value.trim().toLowerCase();
      const correctAnswer = sets[Object.keys(sets).find(set => 
        sets[set].some(([hiragana, romanji]) => hiragana === currentTrainingChar)
      )].find(([hiragana]) => hiragana === currentTrainingChar)[1].toLowerCase();

      if (input === correctAnswer) {
        matchSound.play();
        document.getElementById("feedback").textContent = "Correto!";
        trainingHits++;
        document.getElementById("trainingHits").textContent = trainingHits;
      } else {
        errorSound.play();
        document.getElementById("feedback").textContent = `Errado! O correto é ${correctAnswer}.`;
        trainingErrors++;
        document.getElementById("trainingErrors").textContent = trainingErrors;
        // Registrar o erro com a entrada do jogador e o número da jogada
        if (!errorStats[currentTrainingChar]) {
          errorStats[currentTrainingChar] = [];
        }
        errorStats[currentTrainingChar].push({ turn: trainingTotal + 1, input: input });
      }

      trainingTotal++;
      document.getElementById("trainingTotal").textContent = trainingTotal;
      document.getElementById("trainingRemaining").textContent = trainingLimit - trainingTotal;
      nextTrainingChar();
    }

    // Voltar ao menu
    function returnToMenu() {
      clickSound.play();
      document.querySelector('.menu').style.display = 'block';
      document.querySelector('.game-controls').style.display = 'none';
      document.getElementById("gameContainer").style.display = 'none';
      document.getElementById("trainingContainer").style.display = 'none';
      document.getElementById("winModal").style.display = 'none';
      document.getElementById("modalOverlay").style.display = 'none';
      if (timerInterval) clearInterval(timerInterval);
      // Limpar estado do treino ao voltar ao menu
      trainingHits = 0;
      trainingErrors = 0;
      trainingTotal = 0;
      errorStats = {};
      lastTrainingChar = null;
      document.getElementById("restartTraining").style.display = "none";
      document.getElementById("errorList").style.display = "none";
    }

    // Virar carta
    function flipCard(card) {
      if (lockBoard || card === firstCard || card.classList.contains("matched") || card.style.background === "transparent") return;

      flipSound.play();
      card.classList.add("flipped");
      card.innerText = card.dataset.char;

      if (!firstCard) {
        firstCard = card;
        return;
      }

      secondCard = card;
      lockBoard = true;

      checkMatch();
    }

    // Verificar par
    function checkMatch() {
      const firstChar = firstCard.dataset.char;
      const secondChar = secondCard.dataset.char;

      // Incrementar tentativas
      attempts += 1;
      document.getElementById("attempts").textContent = attempts;

      // Verificar se formam um par Hiragana-Romanji
      const pairs = Object.values(sets).flat();
      const isMatch = pairs.some(([hiragana, romanji]) => 
        (firstChar === hiragana && secondChar === romanji) || 
        (firstChar === romanji && secondChar === hiragana)
      );

      if (isMatch) {
        firstCard.classList.add("matched");
        secondCard.classList.add("matched");
        matchSound.play();
        matchesFound += 1;
        document.getElementById("matches").textContent = matchesFound;
        resetTurn();

        if (matchesFound === totalPairs) {
          const endTime = Date.now();
          const timeTaken = (endTime - startTime) / 1000;
          const minutes = Math.floor(timeTaken / 60);
          const seconds = Math.round(timeTaken % 60);
          const cardCount = totalPairs * 2;
          const winModal = document.getElementById("winModal");
          const modalOverlay = document.getElementById("modalOverlay");
          document.getElementById("winMessage").textContent = 
            `Você completou o jogo com ${cardCount} cartas em ${minutes} min e ${seconds} seg!`;
          winModal.style.display = "block";
          modalOverlay.style.display = "block";
          winSound.play();
          if (timerInterval) clearInterval(timerInterval);
        }
      } else {
        errorSound.play();
        setTimeout(() => {
          firstCard.classList.remove("flipped");
          secondCard.classList.remove("flipped");
          firstCard.innerText = "?";
          secondCard.innerText = "?";
          resetTurn();
        }, 1000);
      }
    }

    // Resetar turno
    function resetTurn() {
      firstCard = null;
      secondCard = null;
      lockBoard = false;
    }

    // Adicionar evento Enter para confirmar resposta
    document.getElementById("inputRomanji").addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        checkAnswer();
      }
    });
  </script>
</body>
</html>